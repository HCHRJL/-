# **車牌辨識**
---
## **導入文件**
**1.在 Python36 資料夾建立新的資料夾**
* 車牌辨識

**2.將文件（程式碼及影像範例）放入其中**
> [車牌辨識GITHUB](https://reurl.cc/0pnxAo)

---
## **圖片大小重設**
**1. 將圖片大小重設置**
* 執行 [ resize_sr.py ]
```
def emptydir(dirname):          #清空資料夾
    if os.path.isdir(dirname):  #資料夾存在就刪除
        shutil.rmtree(dirname)
        sleep(2)                #刪除檔案~需延遲,否則會出錯
    os.mkdir(dirname)           #建立資料夾

def dirResize(src, dst):
    myfiles = glob.glob(src + '/*.JPG')  #讀取資料夾內全部jpg檔案
    emptydir(dst)
    print(src + ' 資料夾：')
    print('開始轉換圖形尺寸！')
    for i, f in enumerate(myfiles):
        img = Image.open(f)
        img_new = img.resize((300, 225), PIL.Image.ANTIALIAS)  #尺寸300x225
        outname = str("resizejpg") + str('{:0>3d}').format(i+1) + '.jpg'
        img_new.save(dst + '/' + outname)
    print('轉換圖形尺寸完成！\n')

import PIL
from PIL import Image
import glob
import shutil, os
from time import sleep

dirResize('carPlate_sr', 'carPlate')
dirResize('realPlate_sr', 'realPlate')
```
**2. 將圖片轉至BMP檔點陣圖**
* 執行 [ changebmppy ]
```
from PIL import Image
import glob
import os

myfiles = glob.glob("carPlate/*.JPG")
print('開始轉換圖形格式！')
for f in myfiles:
    namespilt = f.split("\\")
    img = Image.open(f)
    outname = namespilt[1].replace('resizejpg', 'bmpraw')#置換檔名
    outname = outname.replace('.jpg', '.bmp') #置換附加檔名
    img.save('carPlate/'+ outname, 'bmp')     #以bmp格式存檔
    os.remove(f)
print('轉換圖形格式結束！')
```
**3. 將圖片灰階化**
* 執行 [ resize_gray.py ]
```
def emptydir(dirname):
    if os.path.isdir(dirname):
        shutil.rmtree(dirname)
        sleep(2)  #需延遲,否則會出錯
    os.mkdir(dirname)

import PIL
from PIL import Image
import glob
import shutil, os
from time import sleep

myfiles = glob.glob("carNegative_sr/*.JPG")
emptydir('carNegative')
print('開始轉換尺寸及灰階！')
for i, f in enumerate(myfiles):
    img = Image.open(f)
    img_new = img.resize((500, 375), PIL.Image.ANTIALIAS)
    img_new = img_new.convert('L')  #轉換為灰階
    outname = str("negGray") + str('{:0>3d}').format(i+1) + '.jpg'
    img_new.save('carNegative/'+ outname)

print('轉換尺寸及灰階結束！')
```
---
##  下載OpenCV 3.4.9
**1. 將下載好之部分檔案放置其資料夾中**
* **[\opencv\build\x64\vc15\bin]**  中三個檔案 
    * opencv_traincascade.exe
    * opencv_createsamples.exe
    * opencv_word349.dll
* 放置此資料夾 **[\Haar-Training_carPlate\Haar-Training-master\training]**

**2. 更改[train資料夾中]檔案內容**
* 更改 [haarTraining.exe] 為 [opencv_traincascade.exe]
* 更改 [samples_creation.exe] 為 [opencv_createsamples.exe]
---
## 取代檔案
**1. 將 bmp檔 複製並取代 目的地檔案**
* [Haar-Training_carPlate\training\positive\rawdata] 資料夾

**2. 將 灰階化圖片 複製並取代 目的地檔案**
* [Haar-Training_carPlate\training\negative] 資料夾
---
## 影像車牌表單
* 執行 [create_list.py]
```
import glob,os

fp = open('Haar-Training_carPlate/training/negative/bg.txt', 'w')
files = glob.glob("Haar-Training_carPlate/training/negative/*.jpg")
print('開始產生 bg.txt')
text=""
for file in files:
    basename=os.path.basename(file)  # 取得檔名
    filename= "negative/" + basename # negative/negGray???.jpg                     
    text += filename + "\n"
    print(text)
    
fp.write(text) 
fp.close()   
print('bg.txt！完成!')
```
---
## 標記車牌位置
**1. 將樣本圖檔來標記資料**
**2. 執行 [objectmarker.exe]**
* [C:\Python36\0601\Haar-Training_carPlate\training\positive]

**3. 框選車牌部分**
**4. 獲取info檔案**
**5. 執行 [ picMark ]**

```
def emptydir(dirname):
    if os.path.isdir(dirname):
        shutil.rmtree(dirname)
        sleep(2)  #需延遲,否則會出錯
    os.mkdir(dirname)

from PIL import Image, ImageDraw
import shutil, os
from time import sleep

fp = open('Haar-Training_carPlate/training/positive/info.txt', 'r')
lines = fp.readlines()  #讀取所有文字
emptydir('picMark')
print('開始繪製圖框！')
for line in lines:
    data = line.split(' ')
    img = Image.open('Haar-Training_carPlate/training/positive/' + data[0])  #讀取檔案
    draw = ImageDraw.Draw(img)  #繪圖
    n = data[1]  #圖框數量
    #繪製圖框
    for i in range(int(n)):
        x = int(data[2+i*4])
        y = int(data[3+i*4])
        w = int(data[4+i*4])
        h = int(data[5+i*4])
        draw.rectangle((x, y, x+w, y+h), outline='red')
    filename = (data[0].split('/'))[-1]
    img.save('picMark/' + filename)  #存檔

fp.close()   
print('繪製圖框結束！')
```

---
